---
layout: default
title: $E000-$FFFF - Kernal Rom, Standard Commodore Jump Table
---
# $E000-$FFFF - Kernal Rom, Standard Commodore Jump Table

# Kernal ROM

In software engineering jargon, the collection of subroutines
that perform basic input and output functions for a computer
is referred to as the operating system kernel. The developers
of the kernel for the original Commodore PET spelled (or misspelled)
the term as kernal, and Commodore operating systems
have been referred to as the Kernal ever since. There are both
similarities and significant differences between the 128 Kernal
and the Kernals of earlier models.

The Kernal handles input from or output to five basic
sources: the keyboard, the video screen, the tape drive (Datassette),
the RS-232 port, and the serial bus (to which disk
drives and printers are connected). In the 128 Kernal, all keyboard
and video functions have been transferred to a separate
block of ROM, the screen editor, at [$C000](C000#C000).

Significant enhancements include the addition of an 80-
column screen, ESC-key screen-editing sequences, and keyboard table
pointers in RAM that make it easy to customize
the keyboard. Tape and RS-232 support is largely unchanged
from that provided in the Commodore 64 Kernal. Serial bus
operation is significantly enhanced by the addition of a new
fast serial mode which can transfer data much more quickly
than the old system, now fittingly referred to as slow serial
mode.

Additional new features of the 128 Kernal include routines
to handle the storage, retrieval, and comparison of data from
the various memory banks supported by the system, and support for DMA
(Direct Memory Access) transfer operations to
and from the 1700 and 1750 Memory Expansion Modules.

The heart of the Kernal is the collection of routines called
by the Kernal jump table at 65409-65525/$FF81-$FFF5. The
routines called from that table, and their supporting subroutines,
make up the bulk of the Kernal and provide access to
the majority of the 128's input/output (I/O) capabilities.
Almost any I/O operation can (and should) be performed
through the appropriate jump table entry. The Kernal jump
table has been a feature of all Commodore operating systems.

The 128 adds an additional jump table with 19 new entries at
65351-65407/$FF47-$FF7F. These entries provide access to
most of the 128 Kernal's new or enhanced features.

## 57344 $E000 RESET
### Performs main system initialization sequence.
Resets the processor stack pointer to the top of the stack,
disables IRQ interrupts, and insures that the processor is not in
decimal mode; then sets the MMU configuration register for
bank 15. Other MMU registers are initialized from the table at
57419/$E04B. Next, the initialization status flag (2564/$0A04)
is reset to 0/$00 to indicate that all variables and vectors need
to be initialized. The interrupt and reset handling routines at
65285-65348/$FF05-$FF44 in Kernal ROM are copied to that
same area in all RAM banks, and the INDFET, INDSTA,
INDCMP, JSRFAR, JMPFAR, and DMA-CALL routines are
copied from the table at 63488/$F800 into bank 0 RAM.

Locations 65525-65527/$FFF5-$FFF7 in bank 1 are then
examined to see if they contain the character codes for the letters
CBM. If not, those locations are initialized with that character
pattern, and the soft reset vector at 65528/$FFF8 in bank
1 is initialized. However, if the test pattern is found (indicating
that RESET has already been performed at least once), the
routine jumps to the address in the vector. Normally, the vector
points to the routine at 57892/$E224, which simply
reinitializes the test pattern and vector. You can change the
address to add your own extra steps to the reset sequence.

The subroutine at 57922/$E242 is called to check for the
presence of a Commodore 64 cartridge. If one is detected, the
system is switched to 64 mode and the computer becomes a
Commodore 64. (You must press the RESET button or turn
the computer off and back on to return to 128 mode.) Otherwise,
the subroutine records the presence of any 128 function
ROMs in the table at 2753-2756/$0AC1-$0AC4. If a logged
function ROM is autostarting, its cold start routine is called. It
is possible that an autostarting ROM will retain control of the
system and will not return to complete the reset sequence.

Next, the IOINIT routine [$E109](#E109) is called to initialize the
video, CIA, and SID chip registers. The keyboard column
which includes the RUN/STOP and Commodore keys is
scanned. If RUN/STOP has been pressed, the Kernal memory
initialization flag (2562/$0A02) is checked. If the flag contains
a nonzero value, the following memory initialization step is
skipped. Since the flag is given the value 165/$A5 after the
first call to RAMTAS [$E093](#E093), zero-page values and memory
pointers are preserved if RUN/STOP is held down during a
subsequent reset. Otherwise, RAMTAS [$E093](#E093) is called to
clear all zero-page RAM locations and reestablish Kernal
pointers.

RESTOR [$E056](#E056) is called to load default Kernal indirect
vectors into 788-819/$0314-$0333. CINT [$C000](C000#C000) is called to
initialize the screen editor, after which IRQ interrupts are once
again allowed. If the RUN/STOP key has been pressed, the
monitor is entered through its cold start entry point [$B000](B000#B000). If
the Commodore key has been held down, 64 mode is entered
using the C64-MODE routine [$E24B]. Otherwise, BASIC 7.0
is entered via the restart vector at 2560/$0A00. If the
RAMTAS step has been performed, the restart vector will
point to BASIC's cold start entry point [$4000](4000#4000).

It is possible to perform most of the reset sequence without losing
the BASIC program currently in memory. Simply
hold down RUN/STOP while pressing the RESET button.
This will skip the RAMTAS step, which would wipe out important
program pointers. You will land in the monitor after
the reset; type X to exit to BASIC, where the current program
should still be intact.

Note that the reset routine does not explicitly attempt to
boot a disk or to initialize function ROMs that are not
autostarting. These tasks are performed by the Kernal PHOENIX routine
[$F867](#F867). In 128 ROM, PHOENIX is called only
during the BASIC cold start routine [$4023](4000#4023). However, as long
as the RUN/STOP or Commodore key is not held down, the
reset routine ends by jumping to the BASIC cold start routine,
so those actions are implicitly part of the normal reset
sequence.

## 57419 $E04B
### Table of default MMU register settings.
The 11 values in this table are copied into the MMU chip registers at
[$D500-$D50A](D500#D500) by the system reset routine [$E000](#E000).

## 57430 $E056 RESTOR
### Restores Kernal indirect vectors to their default values.
<span class="badge badge-info">This routine has a Kernal jump table entry at [$FF8A](#FF8A)</span>

Loads the X and Y registers with the value [$E073](#E073), the
address of the default vector table, then clears the status register
carry bit, and falls through into the following routine to
load default vector values.
